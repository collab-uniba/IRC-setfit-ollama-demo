services:
  ollama:
    build:
      context: .
      dockerfile: dockerfiles/dockerfile.ollama
    container_name: ollama-service
    ports:
      - "${OLLAMA_PORT}:11434"
    environment:
      - OLLAMA_HOST=${OLLAMA_HOST}
    restart: unless-stopped

  setfit:
    build:
      context: .
      dockerfile: dockerfiles/dockerfile.setfit
    container_name: setfit-service
    ports:
      - "${SETFIT_PORT}:8000"
    environment:
      - HOST=${SETFIT_HOST}
      - PORT=${SETFIT_PORT}
    restart: unless-stopped

  vector-store:
    build:
      context: .
      dockerfile: dockerfiles/dockerfile.vectorstore
    container_name: vector-store-service
    ports:
      - "${VECTOR_STORE_PORT}:8001"
    environment:
      - HOST=${VECTOR_STORE_HOST}
      - PORT=${VECTOR_STORE_PORT}
      - CHROMA_DATA_PATH=/data/chroma
      - DATA_DIR=/app/data
    volumes:
      - vector_store_data:/data/chroma
      - ./data:/app/data:ro
    restart: unless-stopped

  app:
    build:
      context: .
      dockerfile: dockerfiles/dockerfile.ui
    container_name: ui-service
    ports:
      - "${UI_PORT}:7860"
    environment:
      - HOST=${UI_HOST}
      - PORT=${UI_PORT}
      - OLLAMA_HOST=${DOCKER_OLLAMA_BASE_URL}
      - SETFIT_BASE_URL=${DOCKER_SETFIT_BASE_URL}
      - VECTOR_STORE_BASE_URL=${DOCKER_VECTOR_STORE_BASE_URL}
    depends_on:
      ollama:
        condition: service_started
      setfit:
        condition: service_started
      vector-store:
        condition: service_started
    restart: unless-stopped

volumes:
  ollama_data:
  vector_store_data:
